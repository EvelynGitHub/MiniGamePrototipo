<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MiniGame</title>
</head>
<body>
    <h1>MiniGamePrototipo</h1>
    <hr>
    <canvas id="canvas" width="300" height="300"></canvas>
    <hr>


    <script>
    let canvas = document.getElementById("canvas")
    let scene = canvas.getContext("2d")


    //====== Elementos do jogo =========
    let mapa = new Image()
    mapa.src = "img/scene.png"

    let player = new Image()
    player.src = "img/img.png"
    //=================================

    // ======= Objetos do Jogo ========
    let gameObjectsList = []

    let gameObjectMapa = {
        img: mapa,
        x:0,
        y:0,
        //Altura e lagura da imagem mapa
        width: 800,
        height: 600
    };

    let gameObjectPlayer = {
        img: player,
        x:0,
        y:0,
        width: 24,
        height: 31,
        speed: 2
    };

    gameObjectsList.push(gameObjectMapa)
    gameObjectsList.push(gameObjectPlayer)

    let objectCamera = {
		x: 0,
		y: 0,
		width: scene.width,
		height: scene.height,
		leftEdge: function(){
			return this.x + (this.width * 0.25);
		},
		rightEdge: function(){
			return this.x + (this.width * 0.75);
		},
		topEdge: function(){
			return this.y + (this.height * 0.25);
		},
		bottomEdge: function(){
			return this.y + (this.height * 0.75);
		}
	};
    // ============================================

    // ====== Renderiza os elementos do jogo =======
    function render(){
        // scene.save()

        for(let index in gameObjectsList){
            let gameObject = gameObjectsList[index]
            scene.drawImage(gameObject.img, 
                            0, 
                            0,
                            gameObject.width,
                            gameObject.height,
                            gameObject.x,
                            gameObject.y,
                            gameObject.width,
                            gameObject.height)
        }

        // scene.retore()

    }

    //======= Atualiza as informações de jogo
    function update(){

        //limite do char
        if (gameObjectPlayer.x < 0) {
            gameObjectPlayer.x = 0;
        }
        if (gameObjectPlayer.x + gameObjectPlayer.width > gameObjectMapa.width) {
            gameObjectPlayer.x = gameObjectMapa.width - gameObjectPlayer.width;
        }
        if (gameObjectPlayer.y < 0) {
            gameObjectPlayer.y = 0;
        }
        if (gameObjectPlayer.y + gameObjectPlayer.height > gameObjectMapa.height) {
            gameObjectPlayer.y = gameObjectMapa.height - gameObjectPlayer.height;
        }


        if(gameObjectPlayer.x < objectCamera.leftEdge()){
            objectCamera.x = char.x - (objectCamera.width * 0.25);
            console.log("limite esquerdo da camera")
        }
        if (gameObjectPlayer.x + gameObjectPlayer.width > objectCamera.rightEdge()) {
            objectCamera.x = gameObjectPlayer.x + gameObjectPlayer.width - (objectCamera.width * 0.75);
            console.log("limite direito da camera")
        }
        if (gameObjectPlayer.y < objectCamera.topEdge()) {
            objectCamera.y = gameObjectPlayer.y - (objectCamera.height * 0.25);
            console.log("limite superior da camera")
        }
        if (gameObjectPlayer.y + gameObjectPlayer.height > objectCamera.bottomEdge()) {
            objectCamera.y = gameObjectPlayer.y + gameObjectPlayer.height - (objectCamera.height * 0.75);
            console.log("limite inferior da camera")
        }


        console.log(gameObjectPlayer.x)
    }
    

    function loop(){
        window.requestAnimationFrame(loop, scene);
        render()
        update()
    }

    loop()

    document.addEventListener("keydown", function(e){
        // console.log(e)

        let actionClick = {
            ArrowDown(){
                gameObjectPlayer.y += gameObjectPlayer.speed
                // gameObjectPlayer.y = gameObjectPlayer.height * 3 
            },
            ArrowUp(){
                gameObjectPlayer.y -= gameObjectPlayer.speed
                // gameObjectPlayer.y = gameObjectPlayer.height * 2
            },
            ArrowLeft(){
                gameObjectPlayer.x -= gameObjectPlayer.speed
            },
            ArrowRight(){
                gameObjectPlayer.x += gameObjectPlayer.speed
            }
        }

        actionClick[e.key]()

        console.log("Foi (): "+e.key)
        
    })
    </script>
</body>
</html>